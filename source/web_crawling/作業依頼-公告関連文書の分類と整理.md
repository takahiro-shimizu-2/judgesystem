# 作業依頼-公告関連文書の分類と整理

2026年2月3日

[TOC]

## 作業項目とその背景

**1. 公告関連の文書の種類の整理**
  - 公告に関連する文書(pdf,xlsx,など)の種類を網羅的に把握し、分類する。
  - 現時点では一部の種類 ("公告"・"仕様書"・"競争参加者の資格に関する公示"、など) しか確認できていません。公告に関連する文書が、どの種類に該当するかを整理する必要があります。

**2. 要件文を抽出すべき文書種別の特定**
  - 現時点では、"公告" および "競争参加者の資格に関する公示" は要件文を抽出する必要がありますが、他にも対象となる種類が存在する可能性があるため、追加の確認が必要です。
  - 以下の **3. 1件の公告に紐づく文書を正しくまとめる** と関連してきますが、例えば 1 件の公告に対して「公告」と「競争参加者の資格に関する公示」が存在する場合、それぞれの文書から要件文を抽出する必要があります。

**3. 1件の公告に紐づく文書を正しくまとめる**
  - 1件の公告には、公告以外にも複数の関連文書が存在する場合があります。それらを正しく紐づけて整理する必要があります。
  - 同一行に複数文書がまとめられているケース
    - `https://www.mod.go.jp/j/budget/chotatsu/naikyoku/consul/gyomu.html`
      - 「庁舎等整備基本検討」「競争参加者の資格に関する公示」などが1行にまとめられている
  - 日付単位で文書がまとめられているケース
    - `https://www.mod.go.jp/j/budget/chotatsu/naikyoku/nyuusatu/index.html`
      - 「ＨＧＶ対処に係る赤外線センサシステムに関する調査研究」 と 「安否確認サービスの利用」などは、公告単位ではなく日付単位で掲載されています。この場合、公告ごとに関連文書をまとめるのが難しいという課題があります。

## 作業概要

大きく以下の 3 つの作業があります。

1. 公告関連の文書(pdf)の種類の分類
   - 公告掲載ページにある pdf などの内容に基づき、その文書の種類を確認します。
     - pdfについては過去にすでにダウンロードしたものがあります。まずはこれを用いることができます。他のファイル形式(エクセルなど)はダウンロードしていません。可能であれば、pdf 以外の形式についても対応していただきたいです。
     - 文書の種類とは、具体例としては下表にあるものを想定していますが、他にもあるかもしれません。まずは以下の表に記載の種類をベースに分類してください。ちなみに、英語・日本語の違いはこだわらなくてよいです(作業過程では、理解しやすいほうを用いていただければと思います)。

      | 英語            | 日本語             |
      |-----------------|----------------------|
      | announcement    | 公告       |
      | specification   | 仕様書               |
      | bid_form        | 入札書（入札用紙）   |
      | drawing         | 図面                 |
      | explanation     | 説明書／説明資料     |
      | design          | 設計書／設計資料     |
      | bid_documents   | 入札書類             |
      | Public Notice on Eligibility of Bidders   | 競争参加者の資格に関する公示     |

2. 1件の公告に紐づく文書の特定
   - 公告掲載ページにある公告に関連する文書をまとめてください。

3. 1つの公告ごとに関連 pdf をまとめたテーブル作成
   - これは、1. 2. の結果をまとめたものというイメージです。

## 作業詳細

### 公告関連の pdf の内容分類と1件の公告に紐づく文書の特定

#### 前提

関連ファイルとして以下があります。入力は以下の **公告掲載ページ一覧** となります。作業関連のスクリプトがありますが、これに縛られる必要はありません。

- **公告掲載ページ一覧**
  - `data/リスト_防衛省入札_1.txt`

- **公告関連の pdf を抽出・ダウンロードするスクリプト**
  - `main.py` は以下を行います。
    - 公告掲載ページ一覧にある各 url から、公告関連の pdf を抽出・ダウンロードします。
    - 公告ごとの関連文書を、公告ページの html から gemini に判定する処理を実装しましたが、うまくまとめられていません。
      - html で、同一公告が同じ行にまとめられているとは限らず、日付ごとにまとめられていたりするためです。
      - html ソースをそのまま入れる際、トークン化の制限に引っかかる場合があります。また、無視できないコストがかかる可能性があります。
  - `main.py` は、`output` や `output_v2` に結果を出力します。
    - `output` は、以前 `main.py` を実行した結果です。
      - `output/each_list_v1` には、公告掲載ページごとの公告関連 pdf リンクを表にまとめています。
        - 一部の表では、文字化けしてしまっています。
      - `output/pdf[0-9]+` には、公告関連の pdf を保存してあります。
    - `output_v2` は、文字化けを解消した結果です。
      - `output` に対して、結果が異なっていると思われます。大本の公告掲載ページの内容に変更があるためです。
      - pdf は保存していません。

- **公告関連の pdf の種類の判定を行うスクリプト**
  - `source/main.R`
    - このスクリプトでは、1 つ 1 つの pdf を読み込み、そのタイトルや本文に特定の文字列があるかどうかで pdf の種類を判定しています。
    - pdfへのリンクテキストにも情報があることがあります。たとえば(ここでは具体例を提示できませんが)、リンクテキストが `⑪工事に係る入札心得書（別紙）「低価格入札に係る特別重点調査について」` となっているものがあります。この文書の本文は `低価格入札に係る特別重点調査について` となっていて文書の種類が分かりにくいですが、リンクテキストを見れば、`入札心得書` であることが分かります。ただし、現状のスクリプトでは、リンクテキストを考慮した判定処理は実装されていません。

### 1つの公告ごとに関連 pdf をまとめたテーブル作成

以下の列を持つテーブル "announcements_documents" を作成してください。

| 列名        | 値の例                                   |
|--------------|-------------------------------------------|
| document_id  | 'doc-1-ann-1'                                |
| announcement_id  | 'ann-1'                                |
| type         | announcement                               |
| title        | 2024年度 第1四半期レポート                 |
| fileFormat   | pdf                                        |
| pageCount    | 12                                         |
| extractedAt  | 2024-05-12T10:32:00Z                       |
| url          | https://example.com/docs/doc-ann-1-1.pdf   |
| content      | 本レポートでは第1四半期の業績概要をまとめています。 |

- 備考
  - 値の例から検討がつくと思いますが、このテーブルは 1 つの公告(announcement)に関連する1つ以上のファイルをまとめています。
    - 1 つの公告(announcement)ごとに、異なる announcement_id を設定してください。(それぞれの公告の区別が出来るのであれば、連番でよいです)
    - 1 つの announcement_id ごとの document_id には異なる値を設定してください(難しければ、行番号でよいです)。
  - urlは、もともとのwebページのリンクとしてください(本番ではクラウド環境に置かれたurlとなる可能性はあります)。
  - contentは、内容を解析したりはせず、ダミーの文字列を入れておくのでよいです。

## 作業環境

ローカルPC で以下をインストールしていただければ作業環境の再現はできます。

- エディタ
  - visual studio code
- python
  - バージョン管理等の点から[miniconda](https://github.com/conda-forge/miniforge)がよいと思いますが、pythonが使えればなんでもよいです。
- R
  - windows バイナリがたとえば `https://cran.r-project.org/bin/windows/base/` にあります。
  - R 専用の IDE である [Rstudio](https://posit.co/download/rstudio-desktop/) も便利です。
- これまでの出力ファイル(pdfなど)
  - ギガファイル便に zip でアップロードしてあります。`output` フォルダ以下に zip を解凍して配置していただければ、pdf内の内容把握等可能です。パスワードは別途共有します。
    - `pdf1`: `https://15.gigafile.nu/0210-kd33474626ab70cc982fded3c3ba50db7`
    - `pdf2`: `https://72.gigafile.nu/0210-lb353a9f7fa0005afc1871325ba63d9dc`
    - `pdf3`: `https://72.gigafile.nu/0210-i91a95f1364f1d731105ee6e841112ff4`
    - `pdf4`: `https://72.gigafile.nu/0210-nfc326dcd7b87b5bf1e1cb3c3ccac41ea`
    - `pdf5`: `https://72.gigafile.nu/0210-e34490661133522327501365fe64e3bb3`
    - `pdf6`: `https://72.gigafile.nu/0210-cdf460d2eaef4bfdfa5ef08763fe4349a`
    - `pdf7`: 空のフォルダを作成してください。
    - `pdf8`: `https://41.gigafile.nu/0210-jeb06fb42d733a27bf79f992c77a53e1a`
    - `pdf9`: `https://72.gigafile.nu/0210-ia44ea31c7f2324d6568a6924a252ba72`
    - `pdf10`: `https://68.gigafile.nu/0210-j70ed5510f9387f7e04d6a08019abe17e`
    - `pdf11`: `https://68.gigafile.nu/0210-l66393e1099a273ff46a8d2593384b6f5`
    - `pdf12`: `https://41.gigafile.nu/0210-ea552437e26a2353a1612d5cfbce33e55`
    - `pdf13`: `https://41.gigafile.nu/0210-n9211a9770357df6b5fe4086d2707fd5d`
    - `pdf14`: `https://41.gigafile.nu/0210-i178a215e1e1a9a42586b49555f874aed`
    - `each_list`: `https://41.gigafile.nu/0210-bd565e4f0194c30ee54e58a67de8de890`

