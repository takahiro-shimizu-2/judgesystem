FROM node:18-slim

WORKDIR /app

# 依存関係インストール
COPY app/package*.json ./
RUN npm install --omit=dev

# ソースをコピーしてビルド
COPY app/ .
RUN npm run build

# Cloud Run は $PORT を使うので環境変数を渡す
ENV PORT=8080
EXPOSE 8080

# Vite の preview サーバーで配信
CMD ["npm", "run", "preview", "--", "--port", "8080", "--host", "0.0.0.0"]
